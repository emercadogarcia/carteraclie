SELECT 
DISTINCT 
decode(C.ZONA,'0410','SCZ','0420','LPZ','0430','CBBA','0440','TJA','0450','ALTO','0451','ALTO','0460','SCR','0461','SCR','0470','BENI','0471','BENI','SIN REG') REG, CADENA.NOMBRE_CADENA, CANAL_VENTA.CANAL_VENTA, RPN3.RPN_COBRANZA,
DT.CODIGO_CLIENTE, C.NOMBRE,DT.FECHA_FACTURA, DT.FECHA_VENCIMIENTO, DT.DOCUMENTO, DT.CONCEPTO, DT.MONTO_ORIGINAL, DT.IMP_COB COBROS_PREVIOS, DT.IMP_SUS NDC_APLICADAS, DT.FECHA_ASIENTO, DT.ID
FROM
(
SELECT DP.ID, DP.IMPORTE_COBRADO IMP_COB, DP.IMPORTE_SUSTITUIDO IMP_SUS, JC.*
FROM
(
SELECT DOCUMENTO, CONCEPTO, CODIGO_CLIENTE, FECHA_FACTURA, FECHA_VENCIMIENTO, IMPORTE, FECHA_ASIENTO FROM HISTORICO_COBROS 
WHERE EMPRESA = '004' 
  AND SITUACION_APUNTE = 'D' 
  AND CARACTER_ASIENTO IN (
    SELECT 
      CODIGO_CENTRO 
    FROM 
      CENTROS_GRUPO_CCONT CG 
    WHERE 
      CG.EMPRESA = '004' 
      AND CODIGO_GRUPO = '0401'
  ) AND (
    nvl(STATUS_RETENIDO, 'N') in('N', 'S')
  ) AND NVL(STATUS_IMPAGADO, 'N') IN ('N', 'S', 'D', 'P', 'A', 'F')
AND nvl(FACTORING, 'N') IN(
    'N', 
    DECODE ('N', 'S', 'A', 'N'), 
    DECODE ('N', 'S', 'F', 'N')
  ) and (CODIGO_CLIENTE = '008798')
) JC
  LEFT JOIN
  (
SELECT JC.ID, JC.DOCUMENTO, JC.CODIGO_CLIENTE, JC.FECHA_FACTURA, HC.IMPORTE_COBRADO, HC.IMPORTE_SUSTITUIDO, HC.FECHA_MOVIMIENTO
FROM
(
SELECT JC.DOCUMENTO, JC.CODIGO_CLIENTE, FECHA_FACTURA, MAX(FECHA_MOVIMIENTO) FECHA_MOVIMIENTO, MAX(JC.ID) ID
FROM
(
SELECT (CASE HMC.DOCUMENTO_VIVO WHEN 'S' THEN 1 WHEN 'N' THEN 2 ELSE 2 END) ID, HA.FECHA_ASIENTO FECHA_MOVIMIENTO, HMC.DOCUMENTO, HMC.CODIGO_CLIENTE, HMC.FECHA_FACTURA
FROM HISTORICO_MOV_CARTERA HMC, HISTORICO_ASIENTOS HA
WHERE HMC.NUMERO_ASIENTO_BORRADOR = HA.NUMERO_ASIENTO_BORRADOR AND TO_DATE(HMC.FECHA_MOVIMIENTO,'DD/MM/YYYY') = TO_DATE(HA.FECHA_GRABACION,'DD/MM/YYYY')
AND TO_DATE(HA.FECHA_ASIENTO,'DD/MM/YYYY') <= TO_DATE('31/08/2022','DD/MM/YYYY') AND HMC.EMPRESA = '004'
) JC
GROUP BY JC.DOCUMENTO, JC.CODIGO_CLIENTE, FECHA_FACTURA
) JC LEFT JOIN HISTORICO_MOV_CARTERA HC
ON JC.DOCUMENTO = HC.DOCUMENTO AND JC.CODIGO_CLIENTE = HC.CODIGO_CLIENTE AND JC.FECHA_FACTURA = HC.FECHA_FACTURA AND JC.FECHA_MOVIMIENTO = HC.FECHA_MOVIMIENTO
  ) DP 
  ON JC.DOCUMENTO = DP.DOCUMENTO AND JC.CODIGO_CLIENTE = DP.CODIGO_CLIENTE AND JC.FECHA_FACTURA = DP.FECHA_FACTURA
WHERE DP.ID > 0 
) DT, CLIENTES C, (
    SELECT CCE.CODIGO_CLIENTE AS CODIGO_CLIENTE,VC.NOMBRE AS NOMBRE_CADENA
    FROM CLIENTES_CLAVES_ESTADISTICAS CCE, VALORES_CLAVES VC
    WHERE CCE.CLAVE=VC.CLAVE AND CCE.VALOR_CLAVE=VC.VALOR_CLAVE AND CCE.CLAVE='CADN') 
CADENA,(
    SELECT CCE.CODIGO_CLIENTE AS CODIGO_CLIENTE,VC.NOMBRE AS CANAL_VENTA
    FROM CLIENTES_CLAVES_ESTADISTICAS CCE, VALORES_CLAVES VC
    WHERE CCE.CLAVE=VC.CLAVE AND CCE.VALOR_CLAVE=VC.VALOR_CLAVE AND CCE.CLAVE='CANALV')
CANAL_VENTA,(
    SELECT V_CLAVE AS CLAVE,V_VALOR_CLAVE AS CODIGO_RPN,D_VALOR_CLAVE AS RPN_COBRANZA,CODIGO_CLIENTE 
    FROM (
        SELECT clientes_claves_estadisticas.* ,(
            SELECT lvce.nombre 
            FROM claves_estadisticas lvce 
            WHERE lvce.clave = clientes_claves_estadisticas.clave) D_CLAVE,
                (SELECT lvc.nombre 
                FROM valores_claves lvc 
                WHERE lvc.clave = clientes_claves_estadisticas.clave AND lvc.valor_clave = clientes_claves_estadisticas.valor_clave) D_VALOR_CLAVE,CLAVE V_CLAVE,VALOR_CLAVE V_VALOR_CLAVE,VALOR_NUMERICO V_VALOR_NUMERICO 
        FROM clientes_claves_estadisticas
        ) clientes_claves_estadisticas 
    WHERE (CODIGO_EMPRESA='004')  AND V_CLAVE='RPN3'
) RPN3
WHERE DT.CODIGO_CLIENTE=C.CODIGO_RAPIDO and C.CODIGO_EMPRESA='004'AND CADENA.CODIGO_CLIENTE=DT.CODIGO_CLIENTE AND CANAL_VENTA.CODIGO_CLIENTE=DT.CODIGO_CLIENTE AND RPN3.CODIGO_CLIENTE=DT.CODIGO_CLIENTE /*AND DT.CODIGO_CLIENTE='008798'*/
ORDER BY REG, NOMBRE_CADENA, CANAL_VENTA, RPN_COBRANZA, CODIGO_CLIENTE, FECHA_VENCIMIENTO